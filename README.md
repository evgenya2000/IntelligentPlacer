# IntelligentPlacer
## Решение задачи с семантическим разрывом

### Постановка задачи

  На вход поступает фотография, на которой имеется некоторое множество предметов, ранее выбранных и зафиксированных. Также на фотографии расположен белый лист бумаги А4, на котором черным маркером нарисован многоугольник произвольного размера.

  Алгоритм должен определить, поместятся ли предметы в этот многоугольник с помощью параллельного переноса. Объекты могут поместиться в многоугольнике, если при его наложении на совокупность предметов, никакая из сторон объектов не будет выходить за границы фигуры (сторона обекта может лежать на границе).
  
### Требования к входным и выходным данным

#### Вход: 
  ##### Требование к изображениям:
1. Изображения должно быть в .jpg формате
2. Фотографии должны быть сделаны сверху, перпендикулярно плоскости объекта
3. Все фотографии сделаны при одинаковом освещении, изображения не менее 1 Мп
4. Объекты на фотографии имеют чёткую границу, отсутствуют засвеченные области и тени высокой интенсивности
5. Изображения цветные, без цветовой коррекции и наложения фильтров
  ##### Требование к предметам:
1. Предметы не сливаются с поверхностью
2. Предметы не перекрывают друг друга
3. Предметы не имеют общих границ (расстояние между предметами не менее 0.5 см)
4. Предмет может присутствовать на изображении только в единственном экземпляре
5. Предметы можно вращать, но плоскость предмета с наибольшей площадью должна находиться параллельно плоскости стола
  ##### Требование к поверхности:
1. Поверхность должна быть однотонной
2. Поверхность должна быть одна для всех фотографий
  ##### Требования к исходным данным
1. Исходные данные содержат изображения десяти различных предметов
2. Фотографии исходных предметов сделаны на чистом белом листе A4, при этом предметы находятся в центре листа
3. Края листов бумаги на фото хорошо видны
  ##### Требования к входным данным
1. Левую половину изображения занимает белый лист бумаги A4 в горизонтальной ориентации, на котором нарисован многоугольник черным цветом
2. Правую половину изображения занимают предметы
3. Изображение не обязательно должно быть горизонтальным, но лист с многоугольником должен находиться слева, а предметы  справа
4. Число вершин нарисованного многоугольника не больше 10
5. Края листа бумаги на фото хорошо видны
#### Выход:
В качестве ответа на задачу, в консоль будет выведен идин из ответов:
  1) YES, если объекты помещаются в многоугольник
  2) NO, в противном случае.
  
Также в случае успеха будет выведен результат размещения предмета в бинарном варианте
### Данные
  Изображения 10 предметов хранятся в папке [iteam](https://github.com/evgenya2000/IntelligentPlacer/tree/develop/data/iteams)
  Все тесты хранятся в папке [case](https://github.com/evgenya2000/IntelligentPlacer/tree/develop/data/case)
  Описание предметов и тестов доступно по [ссылке](https://github.com/evgenya2000/IntelligentPlacer/blob/develop/data/dataset.md)

### План алгоритма
#### Обработка изображений 10 предметов
1. Загрузить изображения
2. Сжать изображения и сделать их черно-белыми для ускорения последующих операций для ускорения последующих операций
3. Бинаризировать изображения с применением threshold_otsu и морфологических операций
4. Получить маски предметов и обрезаем изображения по маскам

#### Поиск многоугольника и предметов на входном изображении
1. Загрузить изображения
2. Сжать изображения и сделать их черно-белыми для ускорения последующих операций
3. Найти контур листа и разрезать справа относительно контура листа изображение попалам
4. Найти маску фигуры на изображении с листом
5. Найти маску на изображении с объектами с помощью удаления фона и морфологических операций

#### Сопоставление многоугольника и предметов

1. Найти сумму площадей найденных предметов и сравнить с площадью многоугольника, если сумма площадей предметов превосходит площадь многоугольника, то прервать работу алгоритма и вернуть NO
2. Найти точки 'up', 'down', 'left', 'right' фигуры на листе
![Фигура_точки (3)](https://user-images.githubusercontent.com/72349827/206784483-251ddb02-3974-4c35-b6f4-bf5f1f352dc6.jpg)

3. Найти точки 'up', 'down', 'left', 'right' объектов
![Объекты_точки](https://user-images.githubusercontent.com/72349827/206783960-b955d7ca-c0b0-4b1f-af14-c8a7b15a591f.jpg)
Если точки не нашлись, знаит объектов на изображении нет, значит вернуть YES

4. Проверить, что высота и ширина фигуры не меньше высоты и ширины описывающего объекты прямоугольника соответственно, если иначе, то вернуть NO
5. Найти индексы контура фигуры на листе
6. Совмещать по очереди 4 крайних точки объектов с пикселями контура фигуры на листе (например, совместить точку up объектов с 1м пикселем и с iм пикселем на контуре) пока не закончатся точки или не найдется удачный вариант
![Up1](https://user-images.githubusercontent.com/72349827/206785201-487007c1-6e54-48bc-9360-5733caaafd45.jpg)
![up2](https://user-images.githubusercontent.com/72349827/206785220-48b59827-210d-4923-be5e-709b2de01d67.jpg)

7. При удачном размещении всех предметов алгоритм возвращает YES, а изображение найденного алгоритмом варианта возвращается из функции в массиве, при не удачном размещении алгоритм возвращает NO

Оценка качества результатов: 
По итогу работы алгоритм правильно обработал 24/27 изображений
Точность алгоритма составила 0,85
Неправильно обработанные примеры были плохо освещены или состояли из необычных случаев (точка, предельный случай)

Идеи по улучшению: в дальнейшем можно выделять контуры каждого предмета и проходится по пикселям контурам предмета вместо крайних точек  совокупности объектов.
